#Makefile for use on chmlinxx computers.
#Made with the aid of the fmkmf utility (Copyright (c) The University of Edinburgh) 

F90=ifort
FFLAGS=-openmp -O2
FLINKS=-Wl,--start-group -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -Wl,--end-group -lpthread
VPATH=../src

# Link step

all: Main avrgpops timehist

Main:BLAS.o zgesv_with_dpndnss.o zheev_with_dpndnss.o randgen.o vars.o alarrays.o sb.o hp.o fp.o mp.o iv.o dcerf.o cp.o hh.o redirect.o Ham.o outputs.o Chks.o derivsMCE1.o derivsMCE2.o derivsCCS.o derivs.o propcntrl.o bsetgen.o bsetalter.o readpars.o Main.o 
	 $(F90) $(FFLAGS) -o MCE.exe BLAS.o zgesv_with_dpndnss.o zheev_with_dpndnss.o randgen.o vars.o alarrays.o sb.o hp.o fp.o mp.o iv.o dcerf.o cp.o hh.o redirect.o Ham.o outputs.o Chks.o derivsMCE1.o derivsMCE2.o derivsCCS.o derivs.o propcntrl.o bsetgen.o bsetalter.o readpars.o Main.o $(FLINKS)
	 
avrgpops:avrgpops.f90
	 $(F90) $(FFLAGS) -o avrgpops.exe $<
	 
timehist:timehist.f90
	 $(F90) $(FFLAGS) -o timehist.exe $<

# Compile steps
 
vars.o:vars.f90  
	 $(F90) $(FFLAGS) -c $<
	  
BLAS.o:BLAS.f
	 $(F90) $(FFLAGS) -c $<
	
zgesv_with_dpndnss.o:zgesv_with_dpndnss.f
	 $(F90) $(FFLAGS) -c $<
	
zheev_with_dpndnss.o:zheev_with_dpndnss.f
	 $(F90) $(FFLAGS) -c $<
	 
randgen.o:randgen.f
	 $(F90) $(FFLAGS) -c $<

alarrays.o:alarrays.f90 vars.o 
	 $(F90) $(FFLAGS) -c $<

sb.o:sb.f90 vars.o 
	 $(F90) $(FFLAGS) -c $<

hp.o:hp.f90 vars.o 
	 $(F90) $(FFLAGS) -c $<

fp.o:fp.f90 vars.o 
	 $(F90) $(FFLAGS) -c $<

mp.o:mp.f90 vars.o 
	 $(F90) $(FFLAGS) -c $<

iv.o:iv.f90 vars.o 
	 $(F90) $(FFLAGS) -c $<

dcerf.o:dcerf.f90  
	 $(F90) $(FFLAGS) -c $<

cp.o:cp.f90 dcerf.o vars.o 
	 $(F90) $(FFLAGS) -c $<

hh.o:hh.f90 vars.o 
	 $(F90) $(FFLAGS) -c $<

redirect.o:redirect.f90 vars.o sb.o hp.o fp.o mp.o iv.o cp.o hh.o 
	 $(F90) $(FFLAGS) -c $<

Ham.o:Ham.f90 vars.o alarrays.o redirect.o 
	 $(F90) $(FFLAGS) -c $<

outputs.o:outputs.f90 vars.o 
	 $(F90) $(FFLAGS) -c $<

Chks.o:Chks.f90 vars.o Ham.o 
	 $(F90) $(FFLAGS) -c $<

derivs.o:derivs.f90 vars.o derivsMCE1.o derivsMCE2.o derivsCCS.o 
	 $(F90) $(FFLAGS) -c $<
	 
derivsMCE1.o:derivsMCE1.f90 vars.o Ham.o alarrays.o outputs.o redirect.o 
	 $(F90) $(FFLAGS) -c $<
	 
derivsMCE2.o:derivsMCE2.f90 vars.o Ham.o alarrays.o outputs.o redirect.o 
	 $(F90) $(FFLAGS) -c $<
	 
derivsCCS.o:derivsCCS.f90 vars.o Ham.o alarrays.o outputs.o redirect.o 
	 $(F90) $(FFLAGS) -c $<

propcntrl.o:propcntrl.f90 alarrays.o vars.o derivs.o 
	 $(F90) $(FFLAGS) -c $<

bsetgen.o:bsetgen.f90 vars.o Ham.o alarrays.o outputs.o Chks.o redirect.o propcntrl.o 
	 $(F90) $(FFLAGS) -c $<

bsetalter.o:bsetalter.f90 vars.o Ham.o alarrays.o outputs.o 
	 $(F90) $(FFLAGS) -c $<

readpars.o:readpars.f90 vars.o alarrays.o Ham.o redirect.o 
	 $(F90) $(FFLAGS) -c $<

Main.o:Main.f90 bsetgen.o bsetalter.o Ham.o vars.o readpars.o outputs.o alarrays.o Chks.o propcntrl.o redirect.o 
	 $(F90) $(FFLAGS) -c $<
	 
# This entry allows you to type " make clean " to get rid of
# all object and module files 

clean:
	rm -rf f_{files,modd}* *.o *.mod *.exe *~ ../run/*.exe ../run/*~ ../src/*~
  
